<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<base target="_top">
<title>SVG から PNG への簡易変換</title>
<link rel="canonical" href="https://piyo-ko.github.io/tools/svg2png.html" />
<link rel="stylesheet" href="../article.css" type="text/css">
<style>
svg {
  border: solid 2pt teal;
}
</style>
<script>
function read_convert_download() {
  if (document.user_input.no_css.checked) {
    read_convert_download_0(false, '');
  } else {
    css_reader = new FileReader();
    css_reader.onload = function (e) {
      read_convert_download_0(true, e.target.result);
    }
    css_reader.readAsText(document.getElementById('input_css_file').files[0]);
  }
}

function read_convert_download_0(use_css, css_str) {
  var svg_reader = new FileReader();

  svg_reader.onload = function (e) {
    var svg_str = e.target.result;
    document.getElementById('read_image_div').innerHTML = svg_str;
    var svg_elt = document.getElementsByTagName('svg')[0];
    if (use_css) {
      var style_elts = svg_elt.getElementsByTagName('style');
      var new_style = document.createElementNS(svg_elt.namespaceURI, 'style');
      new_style.textContent = css_str;
      if (style_elts.length === 0) {
        svg_elt.insertBefore(new_style, svg_elt.firstChild);
      } else {
        svg_elt.insertBefore(new_style, style_elts[style_elts.length - 1].nextSibling);
      }
      svg_str = document.getElementById('read_image_div').innerHTML;
    }
    const h = parseInt(svg_elt.height.baseVal.valueAsString);
    const w = parseInt(svg_elt.width.baseVal.valueAsString);
    var canv = document.createElement('canvas');
    canv.width = w;
    canv.height = h;
    var ctx = canv.getContext('2d');
    var i, bg_col;
    for (i = 0; i < 3; i++) {
      if (document.user_input.bg_col[i].checked) {
        bg_col = document.user_input.bg_col[i].value;
        break;
      }
    }
    if (bg_col === 'white' || bg_col === 'black') {
      ctx.fillStyle = bg_col;
      ctx.fillRect(0, 0, w, h);
    } 
    const img_src = 'data:image/svg+xml;charset=utf-8;base64,' + 
                    btoa(unescape(encodeURIComponent(svg_str)));
    var img = new Image();
    img.onload = function() {
      ctx.drawImage(img, 0, 0);

      const main_body = document.getElementById('main_body');
      main_body.appendChild(canv);

      const url = canv.toDataURL('image/png');
      var a = document.createElement('a');
      a.download = 'converted.png';
      a.href = url;
      main_body.appendChild(a);
      a.click();
      main_body.removeChild(a);
      main_body.removeChild(canv);
    };
    img.src = img_src;
  };

  svg_reader.readAsText(document.getElementById('input_svg_file').files[0]);
}
</script>
</head>

<body class="main-text-only" id="main_body">
<h1>SVGからPNGへの簡易変換</h1>

<p>「<a href="https://qiita.com/jkawamoto/items/792359460aa1c364ee90">svg 要素を png 形式の画像に変換する</a>」という記事を参考にして、SVG から PNG への簡易変換ページを作りました。サイズの変更機能などはありません。単純な変換にだけ対応しています。
<a href="../fun/tori_moji.html">鳥文字</a>の SVG ファイルを作って遊んだ後などに利用すると良いかも、と思って作りました。
<a href="https://piyo-ko.github.io/pedigree/pedigree.html">SVG 形式で系図を作成</a>した後にも使えます。
</p>
<hr>
<form name="user_input">
<ol>
<li>
透明な背景の処理方法
(<input type="radio" name="bg_col" value="none" id="bg_col_none" checked><label for="bg_col_none"> 透明のまま</label>
<input type="radio" name="bg_col" value="white" id="bg_col_white"><label for="bg_col_white"> 白</label>
<input type="radio" name="bg_col" value="black" id="bg_col_black"><label for="bg_col_black"> 黒</label>)
を選択して、
</li>
<li>
スタイルを指定するための CSS ファイルを選択するか
(<input type="file" id="input_css_file" name="input_css_file" />)、
あるいは、
<input type="checkbox" name="no_css" id="no_css_checkbox"><label for="no_css_checkbox">CSS ファイルを使わないこと</label>を指示して、
</li>
<li>
SVG ファイルを選択すると
(<input type="file" id="input_svg_file" name="input_svg_file" />)、
</li>
<li>
<input type="button" value="PNG 形式への変換およびダウンロード" onclick="read_convert_download()">が可能となります。
</li>
</ol>
</form>

<hr>
<p>読み込んだ元の SVG ファイルは以下の通り。</p>
<div id="read_image_div"></div>

<nav>[<a href="../index.html">ホーム</a>]</nav>
</body>
</html>

